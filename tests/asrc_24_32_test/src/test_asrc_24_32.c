// Copyright 2024 XMOS LIMITED.
// This Software is subject to the terms of the XMOS Public Licence: Version 1.
#include <xcore/parallel.h>
#include <xcore/hwtimer.h>
#include <xs1.h>
#include <stdlib.h>
#include <stdio.h>
#include <print.h>
#include <platform.h>
#include <xscope.h>

#include <string.h>

#include "src.h"


int fs_code(int frequency) {
    if(frequency == 44100) {
        return  FS_CODE_44;
    } else if(frequency == 48000) {
        return  FS_CODE_48;
    } else if(frequency == 24000) {
        return  FS_CODE_24;
    } else if(frequency == 32000) {
        return  FS_CODE_32;
    } else if(frequency == 88200) {
        return  FS_CODE_88;
    } else if(frequency == 96000) {
        return  FS_CODE_96;
    } else if(frequency == 176400) {
        return  FS_CODE_176;
    } else if(frequency == 192000) {
        return  FS_CODE_192;
    } else {
        printf("Illegal freq %d\n", frequency);
        exit(1);
    }
}


#define     SRC_N_CHANNELS                (1)   // Total number of audio channels to be processed by SRC (minimum 1)
#define     SRC_N_INSTANCES               (1)   // Number of instances (each usually run a logical core) used to process audio (minimum 1)
#define     SRC_CHANNELS_PER_INSTANCE     (SRC_N_CHANNELS/SRC_N_INSTANCES) // Calculated number of audio channels processed by each core
#define     SRC_N_IN_SAMPLES              (4)   // Number of samples per channel in each block passed into SRC each call
                                                // Must be a power of 2 and minimum value is 4 (due to two /2 decimation stages)
#define     SRC_N_OUT_IN_RATIO_MAX        (5)   // Max ratio between samples out:in per processing step (44.1->192 is worst case)
#define     SRC_DITHER_SETTING            (0)   // Enables or disables quantisation of output with dithering to 24b
#define     SRC_MAX_NUM_SAMPS_OUT         (SRC_N_OUT_IN_RATIO_MAX * SRC_N_IN_SAMPLES)
#define     SRC_OUT_BUFF_SIZE             (SRC_CHANNELS_PER_INSTANCE * SRC_MAX_NUM_SAMPS_OUT) // Size of output buffer for SRC for each instance

/* Stuff that must be defined for lib_src */
#define ASRC_N_IN_SAMPLES                 (SRC_N_IN_SAMPLES) /* Used by SRC_STACK_LENGTH_MULT in src_mrhf_asrc.h */

#define ASRC_N_CHANNELS                   (SRC_CHANNELS_PER_INSTANCE) /* Used by SRC_STACK_LENGTH_MULT in src_mrhf_asrc.h */



int32_t sine_wave_48[48] = {
    0,
    70075715,
    138952416,
    205451603,
    268435455,
    326826303,
    379625062,
    425928331,
    464943848,
    496004047,
    518577479,
    532277906,
    536870912,
    532277906,
    518577479,
    496004047,
    464943848,
    425928331,
    379625062,
    326826303,
    268435456,
    205451603,
    138952416,
    70075715,
    0,
    -70075715,
    -138952416,
    -205451603,
    -268435455,
    -326826303,
    -379625062,
    -425928331,
    -464943848,
    -496004047,
    -518577479,
    -532277906,
    -536870912,
    -532277906,
    -518577479,
    -496004047,
    -464943848,
    -425928331,
    -379625062,
    -326826303,
    -268435456,
    -205451603,
    -138952416,
    -70075715,
};

int32_t sine_wave_32[32] = {
    0,
    104738319,
    205451603,
    298269497,
    379625062,
    446391849,
    496004047,
    526555087,
    536870912,
    526555087,
    496004047,
    446391849,
    379625062,
    298269497,
    205451603,
    104738319,
    0,
    -104738319,
    -205451603,
    -298269497,
    -379625062,
    -446391849,
    -496004047,
    -526555087,
    -536870912,
    -526555087,
    -496004047,
    -446391849,
    -379625062,
    -298269497,
    -205451603,
    -104738319,
};

int32_t sine_wave_nyq[2] = {
    134217728,
    -134217728,
};

int expected_wave_32_24[] = {
0,0,0,-6,-222,872,-1226,2684,
-3484,5880,-7570,11134,-14362,19446,-24898,32024,
-40520,50500,-62990,76994,-94756,114670,-139850,168888,
-205604,250296,-308330,385054,-492950,656986,-935608,1507936,
-3282092,14447234,152475804,279400110,389335792,470958984,521920372,536152590,
514796036,457576378,369817656,256324838,125802110,-13653802,-151885014,-280004398,
-388849500,-471348778,-521605080,-536409502,-514585728,-457748828,-369676280,-256440456,
-125707908,13577478,151946464,279955326,388888360,471318318,521628742,536391298,
514599628,457738842,369683878,256435608,125711684,-13579344,-151944914,-279955672,
-388887972,-471318164,-521628796,-536391294,-514599622,-457738838,-369683874,-256435602,
-125711678,13579348,151944918,279955680,388887978,471318168,521628800,536391302,
514599628,457738842,369683878,256435608,125711684,-13579344,-151944914,-279955672,
-388887972,-471318164,-521628794,-536391294,-514599622,-457738838,-369683874,-256435602,
-125711678,13579348,151944918,279955680,388887978,471318168,521628800,536391302,
514599628,457738842,369683878,256435608,125711684,-13579344,-151944914,-279955672,
-388887972,-471318162,-521628794,-536391294,-514599620,-457738838,-369683874,-256435602,
-125711678,13579348,151944918,279955680,388887978,471318168,521628800,536391302,
514599628,457738842,369683880,256435608,125711684,-13579344,-151944914,-279955672,
-388887972,-471318162,-521628794,-536391294,-514599620,-457738838,
};

int expected_wave_32_32[] = {
0,0,0,-2,0,228,4924,5528,
-20934,-32864,-63770,-72506,-98568,-104354,-115048,-125842,
-106628,-138118,-69204,-145388,-1440,-154586,95310,-174270,
217434,-213656,359812,-281660,517306,-386518,687162,-536998,
873388,-747840,1097762,-1058796,1438042,-1612788,2189022,-3494336,
8537498,119536650,216987794,309530416,388717450,453367134,500793588,528406920,
536512474,523062410,490523152,438095562,369859988,286420206,192907204,91118116,
-13389910,-118080940,-217623242,-309327982,-388701612,-453505040,-500582940,-528659008,
-536238058,-523344400,-490242784,-438366514,-369603258,-286659086,-192689382,-91316388,
13559658,117918324,217719242,309155462,388713918,453334362,500533420,528497258,
536151244,523201234,490144900,438252568,369518438,286583920,192636142,91285474,
-13573254,-117910364,-217716248,-309155416,-388713916,-453334354,-500533418,-528497250,
-536151236,-523201228,-490144896,-438252560,-369518434,-286583916,-192636138,-91285468,
13573258,117910370,217716250,309155422,388713920,453334362,500533420,528497258,
536151244,523201234,490144900,438252568,369518438,286583920,192636142,91285474,
-13573254,-117910364,-217716248,-309155416,-388713916,-453334354,-500533418,-528497250,
-536151236,-523201228,-490144896,-438252560,-369518434,-286583916,-192636138,-91285468,
13573258,117910370,217716250,309155422,388713920,453334362,500533420,528497258,
536151244,523201234,490144900,438252568,369518438,286583920,192636142,91285474,
-13573254,-117910364,-217716248,-309155416,-388713916,-453334354,-500533418,-528497250,
-536151236,-523201228,-490144896,-438252560,-369518434,-286583916,-192636138,-91285468,
13573258,117910370,217716250,309155422,388713920,453334362,500533420,528497258,
536151244,523201234,490144900,438252568,369518438,286583920,192636142,91285474,
-13573254,-117910364,-217716248,-309155416,-388713916,-453334354,-500533418,-528497250,
-536151236,-523201228,-490144896,-438252560,-369518434,-286583916,-192636138,-91285468,
};

int expected_wave_32_44[] = {
0,0,0,0,0,-4,-4,338,
3430,8194,544,-20472,-30718,-41712,-69282,-73748,
-79058,-113594,-101684,-100278,-145872,-103894,-102866,-163272,
-72856,-91764,-164056,-4894,-79856,-144880,97134,-86354,
-97594,220616,-132396,-7434,339816,-234190,146852,413782,
-395092,391632,385066,-598892,759968,173206,-805368,1311284,
-364134,-940516,2238784,-1661062,-828512,4572644,-7225670,2714180,
74375402,159342864,224425320,291658312,355748254,406047854,452676758,490109626,
514379912,531574272,536929210,529977422,514607314,487458676,450055242,404982812,
350460956,289017156,222495634,150504410,75866882,12944,-76486774,-151012900,
-222423748,-289704728,-350770866,-404795106,-450804426,-487441084,-514297324,-530806856,
-536416144,-531239424,-515317288,-488874664,-452583058,-407119330,-353366908,-292487832,
-225677044,-154274694,-79764902,-3636630,72573828,147298596,219027758,286320764,
347813914,402258822,448551942,485755128,513114460,530075498,536294532,531645522,
516222692,490338576,454517728,409486050,356156110,295608648,229070670,157890562,
83510780,7438660,-68784214,-143613160,-215531788,-283082644,-344896824,-399721644,
-446446080,-484123278,-511989678,-529480582,-536241534,-532135522,-517245754,-491873974,
-456534336,-411943006,-359003636,-298789034,-232519450,-161537850,-87282676,-11258724,
64993402,139928420,212027790,279830398,341962240,397164188,444317576,482466866,
510838924,528858806,536161338,532598526,518242574,493384416,458527792,414379058,
361832948,301954256,235956440,165176962,91050156,15078222,-61199280,-136236570,
-208513028,-276563944,-339010270,-394586570,-442166524,-480785958,-509662238,-528210180,
-536053912,-533034492,-519213090,-494869794,-460497964,-416794106,-364643888,-305104144,
-239381446,-168807678,-94813006,-18896948,57402068,132537818,204987644,273283468,
336041146,391988930,439993040,479080664,508459690,527534758,535919302,533443408,
520157264,496330096,462444782,419187996,367436336,308238570,242794320,172429838,
98571050,22714724,-53601942,-128832330,-201451930,-269989110,-333054940,-389371394,
-437797204,-477351048,-507231334,-526832550,-535757482,-533825242,-521075032,-497765200,
-464368116,-421560600,-370210128,-311357334,-246194858,-176043234,-102324074,-26531332,
49799078,125120316,197905974,266681062,330051840,386734102,435579168,475597216,
505977244,526103640,535568486,534180022,521966366,499175044,466267902,423911822,
372965142,314460308,249582906,179647708,106071942,30346604,-45993700,-121401940,
-194349952,-263359466,-327031978,-384077178,-433339018,-473819228,-504697474,-525347978,
-535352294,-534507668,-522831200,-500559546,-468144012,-426241516,-375701214,-317547310,
-252958346,-183243052,-109814394,-34160332,
};

int expected_wave_32_48[] = {
0,0,0,0,0,-6,0,20,
940,4924,8202,-1406,-20934,-30480,-38840,-63770,
-75656,-72152,-98568,-115600,-92196,-115048,-145542,-96028,
-106628,-163552,-84950,-69204,-169560,-64438,-1440,-164894,
-44048,95310,-151312,-36682,217434,-129922,-57952,359812,
-99792,-125712,517306,-56090,-260906,687162,13028,-492178,
873388,133334,-871856,1097762,366640,-1534526,1438042,913878,
-2989898,2189022,2761682,-9337120,8537498,78333604,156575440,216987794,
277714822,339275508,388717452,432326244,472337616,500793588,520529430,534114840,
536512474,529201414,514865024,490523152,457130292,417391442,369859988,315342194,
256469550,192907204,125456568,56560600,-13389910,-83594490,-151925090,-217623242,
-279966832,-337263276,-388701612,-433750512,-471248260,-500582942,-521522438,-533488516,
-536238058,-529911708,-514512146,-490242784,-457635036,-417209860,-369603258,-315691670,
-256395606,-192689384,-125689172,-56553062,13559658,83443230,151884686,217719242,
279830726,337156572,388713918,433620246,471107220,500533422,521395346,533336058,
536151244,529792728,514369312,490144900,457533972,417094504,369518438,315619812,
256320842,192636144,125655400,56524654,-13573254,-83438908,-151876900,-217716248,
-279830394,-337156574,-388713916,-433620242,-471107212,-500533418,-521395338,-533336050,
-536151236,-529792724,-514369310,-490144896,-457533964,-417094500,-369518434,-315619808,
-256320836,-192636138,-125655394,-56524650,13573258,83438912,151876906,217716250,
279830398,337156576,388713920,433620248,471107218,500533420,521395344,533336058,
536151246,529792728,514369312,490144900,457533972,417094504,369518438,315619812,
256320842,192636144,125655402,56524654,-13573254,-83438908,-151876898,-217716248,
-279830392,-337156574,-388713916,-433620242,-471107212,-500533416,-521395338,-533336050,
-536151236,-529792722,-514369310,-490144896,-457533964,-417094500,-369518434,-315619806,
-256320836,-192636138,-125655394,-56524650,13573258,83438912,151876906,217716250,
279830400,337156576,388713920,433620248,471107220,500533422,521395346,533336058,
536151246,529792730,514369312,490144900,457533972,417094504,369518438,315619812,
256320842,192636144,125655400,56524654,-13573254,-83438908,-151876898,-217716248,
-279830392,-337156574,-388713916,-433620242,-471107212,-500533418,-521395338,-533336050,
-536151236,-529792722,-514369310,-490144896,-457533964,-417094500,-369518434,-315619806,
-256320836,-192636138,-125655394,-56524650,13573258,83438912,151876906,217716250,
279830400,337156580,388713920,433620248,471107218,500533422,521395344,533336058,
536151244,529792730,514369314,490144900,457533972,417094504,369518438,315619812,
256320842,192636144,125655400,56524654,-13573254,-83438908,-151876898,-217716248,
-279830394,-337156574,-388713916,-433620240,-471107214,-500533418,-521395338,-533336050,
-536151236,-529792722,-514369310,-490144896,-457533964,-417094500,-369518434,-315619808,
-256320836,-192636138,-125655394,-56524650,
};

int expected_wave_48_24[] = {
0,0,0,-4,-2,688,6498,4098,
-26304,-46376,-80506,-92656,-116924,-116256,-120800,-111926,
-87704,-84418,-21774,-46710,66148,-17018,161920,-14176,
252438,-53164,329590,-141812,393330,-279836,453542,-461708,
531914,-686006,670060,-982722,975156,-1535032,1892320,-4265874,
21744488,155988240,283743538,391961696,473636864,522607244,536565594,513235186,
455726974,366323620,252804884,121221208,-17817212,-156403234,-283623562,-392160676,
-473393422,-522876702,-536282618,-513520722,-455445882,-366593566,-252549602,-121458142,
18034420,156207352,283798208,392007320,473526218,522762908,536377214,513439406,
455503964,366527262,252543980,121349542,-18110682,-156336442,-283908120,-392131942,
-473632606,-522856006,-536447620,-513481224,-455521922,-366519562,-252539494,-121349282,
18110696,156336452,283908134,392131946,473632618,522856014,536447626,513481232,
455521932,366519568,252539506,121349288,
};

int expected_wave_48_32[] = {
0,0,0,-6,-58,-970,1450,-3766,
5344,-9454,13002,-19698,26444,-36850,48368,-64040,
82346,-105444,133278,-167086,208718,-258972,322450,-401298,
505670,-645648,850394,-1172438,1738926,-3015410,74573956,183106604,
274750350,361444662,430412002,485676090,520089818,536240292,530407412,505296242,
459878286,397500480,319277500,229236474,130031124,26104550,-79036726,-180980944,
-276088582,-360500398,-431119044,-485128616,-520521996,-535895450,-530683936,-505074242,
-460056196,-397358378,-319390262,-229148200,-130100052,-26052282,78996710,181009860,
276066938,360514896,431108484,485134804,520517668,535897334,530682756,505074356,
460056208,397358384,319390268,229148204,130100056,26052288,-78996708,-181009852,
-276066934,-360514888,-431108478,-485134798,-520517666,-535897328,-530682752,-505074354,
-460056200,-397358378,-319390262,-229148200,-130100052,-26052282,78996710,181009860,
276066938,360514896,431108484,485134804,520517668,535897334,530682756,505074356,
460056208,397358384,319390268,229148204,130100056,26052288,-78996708,-181009852,
-276066934,-360514888,-431108478,-485134798,-520517666,-535897328,-530682752,-505074354,
-460056200,-397358378,-319390262,-229148200,-130100052,-26052282,78996710,181009860,
276066938,360514896,431108484,485134804,520517668,535897334,
};

int expected_wave_48_44[] = {
0,0,0,0,-6,38,4308,23460,
38476,52460,69294,75474,96904,89524,119988,92698,
137364,84234,147876,64870,150240,37086,142786,5268,
123212,-24268,88318,-43120,33424,-40418,-48824,-1298,
-171578,97928,-363006,306428,-700120,772360,-1490144,2216570,
-5644084,48003758,130624582,199057800,270690538,331547942,389797636,436845032,
477740926,506727934,527286758,535642586,534387244,521292524,498444064,464854572,
422340540,370893154,312203704,246995388,176907990,103160674,27358634,-49005170,
-124388206,-197225726,-266097988,-329543844,-386344610,-435285866,-475432044,-505922306,
-526176630,-535755402,-534486736,-522379468,-499674194,-466841622,-424548490,-373651882,
-315183182,-250327288,-180398492,-106813910,-31064736,45313960,120774368,193787272,
262873078,326631766,383771200,433133506,473718338,504703250,525460318,535568896,
534824158,523241170,501054672,468714274,426875352,376385786,318268738,253701956,
183993890,110557178,34879978,-41503982,-117046910,-190217868,-259534054,-323590770,
-381089902,-430866224,-471911020,-503392512,-524672728,-535320410,-535119816,-524074982,
-502409738,-470563132,-429180538,-379100560,-321338130,-257063736,-187579938,-114294828,
-38693514,37691916,113313524,186638820,256181872,320533392,378389264,428577088,
470079760,502056238,523858520,535044784,535388310,524882208,503739314,472388118,
431463954,381796148,324391220,260412490,191156480,118026684,42505062,-33877914,
-109574372,-183050290,-252816682,-317459728,-375669444,-426266182,-468224636,-500694478,
-523017714,-534741980,-535629662,-525662782,-505043322,-474189126,-433725462,-384472334,
-327427836,-263748012,-194723310,-121752538,-46314440,30062222,105829678,179452478,
249438668,314369972,372930548,423933670,466345756,499307320,522150386,534412052,
};

int expected_wave_48_48[] = {
0,0,0,-2,0,154,3298,3774,
-13780,-21912,-43214,-50576,-70538,-78258,-90604,-104430,
-99618,-129772,-94086,-155642,-70998,-183944,-28058,-216804,
36116,-256488,121912,-305386,229032,-366434,357494,-444404,
510148,-549894,699754,-712018,974550,-1030282,1525848,-2233950,
5807070,80182840,147195754,213985096,276135930,333830190,385945946,431078096,
469368690,499000856,520771928,532938098,536673200,530562836,515999130,492029292,
460164352,419959162,372977102,319261668,260380512,196798364,130048056,60915154,
-9138948,-79126760,-147696366,-213782408,-276183270,-333873772,-385845318,-431216058,
-469212694,-499178502,-520620762,-533153630,-536562148,-530789908,-515935708,-492253702,
-460149100,-420171222,-373004092,-319454766,-260439474,-196967992,-130126334,-61058180,
9054700,79012648,147618668,213698896,276122676,333821914,385809370,431195530,
469203798,499183872,520622770,533153662,536562152,530789910,515935712,492253708,
460149104,420171226,373004098,319454766,260439480,196968000,130126340,61058184,
-9054692,-79012644,-147618666,-213698892,-276122666,-333821912,-385809368,-431195524,
-469203796,-499183870,-520622764,-533153658,-536562146,-530789908,-515935708,-492253702,
-460149100,-420171222,-373004092,-319454766,-260439474,-196967992,-130126334,-61058180,
9054700,79012648,147618668,213698896,276122676,333821914,385809370,431195530,
469203798,499183872,520622770,533153662,536562152,530789910,515935712,492253708,
460149104,420171226,373004098,319454766,260439480,196968000,130126340,61058184,
-9054692,-79012644,-147618666,-213698892,-276122666,-333821912,-385809368,-431195524,
-469203796,-499183870,-520622764,-533153658,-536562146,-530789908,-515935708,-492253702,
-460149100,-420171222,-373004092,-319454766,-260439474,-196967992,-130126334,-61058180,
9054700,79012648,147618668,213698896,276122676,333821914,385809370,431195530,
469203798,499183872,520622770,533153662,536562152,530789910,515935712,492253708,
};

int unit_test_asrc(int test_case) {
    int input_frequency;
    int output_frequency;
    int *expected_wave;
    int steps = 200;
    if (test_case == 0) {
        input_frequency = 32000;
        output_frequency = 24000;
        expected_wave = expected_wave_32_24;
    } else if (test_case == 1) {
        input_frequency = 32000;
        output_frequency = 32000;
        expected_wave = expected_wave_32_32;
    } else if (test_case == 2) {
        input_frequency = 32000;
        output_frequency = 44100;
        expected_wave = expected_wave_32_44;
    } else if (test_case == 3) {
        input_frequency = 32000;
        output_frequency = 48000;
        expected_wave = expected_wave_32_48;
    } else if (test_case == 4) {
        input_frequency = 48000;
        output_frequency = 24000;
        expected_wave = expected_wave_48_24;
    } else if (test_case == 5) {
        input_frequency = 48000;
        output_frequency = 32000;
        expected_wave = expected_wave_48_32;
    } else if (test_case == 6) {
        input_frequency = 48000;
        output_frequency = 44100;
        expected_wave = expected_wave_48_44;
    } else if (test_case == 7) {
        input_frequency = 48000;
        output_frequency = 48000;
        expected_wave = expected_wave_48_48;
    } else {
        printf("Bad test case %d\n", test_case);
        return 1;
    }

    asrc_state_t sASRCState[SRC_CHANNELS_PER_INSTANCE];                                   // ASRC state machine state
    int iASRCStack[SRC_CHANNELS_PER_INSTANCE][ASRC_STACK_LENGTH_MULT * SRC_N_IN_SAMPLES * 100]; // Buffer between filter stages
    asrc_ctrl_t sASRCCtrl[SRC_CHANNELS_PER_INSTANCE];                                     // Control structure
    asrc_adfir_coefs_t asrc_adfir_coefs;                                                  // Adaptive filter coefficients

    uint64_t fs_ratio = 0;
    int sine_cnt = 0;

    int inputFsCode = fs_code(input_frequency);
    int outputFsCode = fs_code(output_frequency);

    for(int ui = 0; ui < SRC_CHANNELS_PER_INSTANCE; ui++)
    {
            // Set state, stack and coefs into ctrl structure
            sASRCCtrl[ui].psState                   = &sASRCState[ui];
            sASRCCtrl[ui].piStack                   = iASRCStack[ui];
            sASRCCtrl[ui].piADCoefs                 = asrc_adfir_coefs.iASRCADFIRCoefs;
    }

    fs_ratio = asrc_init(inputFsCode, outputFsCode, sASRCCtrl, SRC_CHANNELS_PER_INSTANCE, SRC_N_IN_SAMPLES, SRC_DITHER_SETTING);

    int in_samples[4];
    int out_samples[20];
    int exp_cnt = 0;
    int errors = 0;
    for(int32_t i = 0; i < steps; i+=4) {
        for(int j = 0; j < 4; j++) {
            in_samples[j] = input_frequency == 48000 ? sine_wave_48[sine_cnt] :  sine_wave_32[sine_cnt];
            sine_cnt++;
            if (input_frequency == 48000) {
                if (sine_cnt == 48) sine_cnt = 0;
            } else {
                if (sine_cnt == 32) sine_cnt = 0;
            }
        }
        int num_samples = asrc_process(in_samples, out_samples, fs_ratio, sASRCCtrl);
        for(int j = 0; j < num_samples; j++) {
//            printf("%d,", out_samples[j]);
//            if (((exp_cnt) & 7) == 7) printf("\n");
            if (1 && abs(out_samples[j] - expected_wave[exp_cnt]) > 25) {
                printf("saw %d expected %d\n", out_samples[j], expected_wave[exp_cnt]);
                errors++;
            }
            exp_cnt++;
        }
    }
//    printf("\n");
    printf("%d -> %d: %d errors\n", input_frequency, output_frequency, errors);
    return errors;
}

int main(void) {
    int errors = 0;
//    errors += unit_test_asrc(0);
//    return errors;
    errors += unit_test_asrc(0);
    errors += unit_test_asrc(1);
    errors += unit_test_asrc(2);
    errors += unit_test_asrc(3);
    errors += unit_test_asrc(4);
    errors += unit_test_asrc(5);
    errors += unit_test_asrc(6);
    errors += unit_test_asrc(7);

    if (errors == 0) {
        printf("PASS\n");
    } else {
        printf("FAIL: %d errors\n", errors);
    }

}


